Last-Update: 2014-12-22
Forwarded: no
Author: Dmitry Smirnov <onlyjob@member.fsf.org>
Description: use system JARs instead of bundled ones.

--- a/bin/xtfs_chstatus
+++ b/bin/xtfs_chstatus
@@ -41,6 +41,6 @@
 
 check_xtreemfs
 check_java
 
-exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:. \
+exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:. \
     org.xtreemfs.utils.xtfs_chstatus $*
--- a/bin/xtfs_cleanup
+++ b/bin/xtfs_cleanup
@@ -41,6 +41,6 @@
 
 check_xtreemfs
 check_java
 
-exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:. \
+exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:. \
     org.xtreemfs.utils.xtfs_cleanup_osd $*
--- a/bin/xtfs_mrcdbtool
+++ b/bin/xtfs_mrcdbtool
@@ -41,6 +41,6 @@
 
 check_xtreemfs
 check_java
 
-exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:. \
+exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:. \
     org.xtreemfs.utils.xtfs_mrcdbtool $*
--- a/bin/xtfs_remove_osd
+++ b/bin/xtfs_remove_osd
@@ -41,6 +41,6 @@
 
 check_xtreemfs
 check_java
 
-exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:. \
+exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:. \
     org.xtreemfs.utils.xtfs_remove_osd $*
--- a/bin/xtfs_scrub
+++ b/bin/xtfs_scrub
@@ -41,6 +41,6 @@
 
 check_xtreemfs
 check_java
 
-exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:. \
+exec $JAVA_HOME/bin/java -ea -cp $XTREEMFS/java/servers/dist/XtreemFS.jar:$XTREEMFS/java/foundation/dist/Foundation.jar:$XTREEMFS/java/lib/*:/usr/share/java/XtreemFS.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:. \
     org.xtreemfs.utils.xtfs_scrub.xtfs_scrub $*
--- a/contrib/xtreemfs-osd-farm/xtreemfs-osd-farm
+++ b/contrib/xtreemfs-osd-farm/xtreemfs-osd-farm
@@ -34,9 +34,9 @@
 
 if [ -z $JAVA_HOME ]; then
   export JAVA_HOME=/usr
 fi
-JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec-1.3.jar"
+JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec.jar"
 
 # For SELinux we need to use 'runuser' not 'su'
 if [ -x "/sbin/runuser" ]; then
   SU="/sbin/runuser"
--- a/etc/init.d/xtreemfs-dir
+++ b/etc/init.d/xtreemfs-dir
@@ -29,9 +29,9 @@
 
 if [ -z $JAVA_HOME ]; then
     export JAVA_HOME=/usr
 fi
-JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec-1.3.jar"
+JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec.jar"
 
 # For SELinux we need to use 'runuser' not 'su'
 if [ -x "/sbin/runuser" ]; then
     SU="/sbin/runuser"
--- a/etc/init.d/xtreemfs-mrc
+++ b/etc/init.d/xtreemfs-mrc
@@ -29,9 +29,9 @@
 
 if [ -z $JAVA_HOME ]; then
     export JAVA_HOME=/usr
 fi
-JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec-1.3.jar"
+JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec.jar"
 
 # For SELinux we need to use 'runuser' not 'su'
 if [ -x "/sbin/runuser" ]; then
     SU="/sbin/runuser"
--- a/etc/init.d/xtreemfs-osd
+++ b/etc/init.d/xtreemfs-osd
@@ -29,9 +29,9 @@
 
 if [ -z $JAVA_HOME ]; then
     export JAVA_HOME=/usr
 fi
-JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec-1.3.jar"
+JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec.jar"
 
 # For SELinux we need to use 'runuser' not 'su'
 if [ -x "/sbin/runuser" ]; then
     SU="/sbin/runuser"
--- a/etc/init.d/xtreemfs-service.template
+++ b/etc/init.d/xtreemfs-service.template
@@ -29,9 +29,9 @@
 
 if [ -z $JAVA_HOME ]; then
     export JAVA_HOME=/usr
 fi
-JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf-java-2.5.0.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec-1.3.jar"
+JAVA_CALL="$JAVA_HOME/bin/java -ea -cp /usr/share/java/XtreemFS.jar:/usr/share/java/BabuDB.jar:/usr/share/java/Flease.jar:/usr/share/java/protobuf.jar:/usr/share/java/Foundation.jar:/usr/share/java/jdmkrt.jar:/usr/share/java/jdmktk.jar:/usr/share/java/commons-codec.jar"
 
 # For SELinux we need to use 'runuser' not 'su'
 if [ -x "/sbin/runuser" ]; then
     SU="/sbin/runuser"
--- a/java/foundation/eclipse-project/.classpath
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<classpath>
-	<classpathentry kind="src" path="src"/>
-	<classpathentry kind="src" path="test"/>
-	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
-	<classpathentry kind="lib" path="../lib/protobuf-java-2.5.0.jar"/>
-	<classpathentry kind="lib" path="../lib/test/junit-4.11.jar"/>
-	<classpathentry kind="lib" path="../lib/test/hamcrest-core-1.3.jar"/>
-	<classpathentry kind="lib" path="../lib/commons-codec-1.3.jar"/>
-	<classpathentry kind="output" path="bin"/>
-</classpath>
--- a/java/pbrpcgen/eclipse-project/.classpath
+++ b/java/pbrpcgen/eclipse-project/.classpath
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <classpath>
 	<classpathentry kind="src" path="src"/>
 	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
-	<classpathentry kind="lib" path="../lib/protobuf-java-2.5.0.jar"/>
+	<classpathentry kind="lib" path="/usr/share/java/protobuf.jar"/>
 	<classpathentry kind="output" path="build/classes"/>
 </classpath>
--- a/java/flease/eclipse-project/.classpath
+++ b/java/flease/eclipse-project/.classpath
@@ -3,8 +3,8 @@
 	<classpathentry kind="src" path="src"/>
 	<classpathentry kind="src" path="test"/>
 	<classpathentry combineaccessrules="false" kind="src" path="/xtreemfs_foundation"/>
 	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
-	<classpathentry kind="lib" path="../lib/test/junit-4.11.jar"/>
+	<classpathentry kind="lib" path="/usr/share/java/junit4.jar"/>
 	<classpathentry kind="lib" path="../lib/test/hamcrest-core-1.3.jar"/>
 	<classpathentry kind="output" path="bin"/>
 </classpath>
--- a/java/foundation/nbproject/project.properties
+++ b/java/foundation/nbproject/project.properties
@@ -23,16 +23,16 @@
 dist.jar=${dist.dir}/Foundation.jar
 dist.javadoc.dir=${dist.dir}/javadoc
 endorsed.classpath=
 excludes=
-file.reference.bcprov-jdk16-139.jar=lib/bcprov-jdk16-139.jar
+file.reference.bcprov-jdk16-139.jar=/usr/share/java/bcprov.jar
 file.reference.cdaclient.jar=lib/cdaclient.jar
-file.reference.junit-4.11.jar=../lib/test/junit-4.11.jar
+file.reference.junit-4.11.jar=/usr/share/java/junit4.jar
 file.reference.config.jar=lib/config.jar
 file.reference.je-3.2.13.jar=lib/je-3.2.13.jar
-file.reference.protobuf-java-2.5.0.jar=../lib/protobuf-java-2.5.0.jar
+file.reference.protobuf-java-2.5.0.jar=/usr/share/java/protobuf.jar
 file.reference.xbean.jar=lib/xbean.jar
-file.reference.commons-codec-1.3.jar=../lib/commons-codec-1.3.jar
+file.reference.commons-codec-1.3.jar=/usr/share/java/commons-codec.jar
 includes=**
 jar.compress=true
 javac.classpath=\
     ${file.reference.commons-codec-1.3.jar}:\
--- a/java/servers/eclipse-project/.classpath
+++ /dev/null
@@ -1,19 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<classpath>
-	<classpathentry kind="src" path="src"/>
-	<classpathentry kind="src" path="test"/>
-	<classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
-	<classpathentry kind="lib" path="../lib/BabuDB.jar"/>
-	<classpathentry kind="lib" path="../lib/commons-codec-1.3.jar"/>
-	<classpathentry kind="lib" path="../lib/test/commons-httpclient-3.0.1.jar"/>
-	<classpathentry kind="lib" path="../lib/test/commons-httpclient-3.0.1-contrib.jar"/>
-	<classpathentry kind="lib" path="../lib/test/commons-logging-1.1.jar"/>
-	<classpathentry kind="lib" path="../lib/test/junit-4.11.jar"/>
-	<classpathentry kind="lib" path="../lib/test/hamcrest-core-1.3.jar"/>
-	<classpathentry kind="lib" path="../lib/jdmkrt.jar"/>
-	<classpathentry kind="lib" path="../lib/jdmktk.jar"/>
-	<classpathentry kind="lib" path="../lib/protobuf-java-2.5.0.jar"/>
-	<classpathentry kind="src" path="/xtreemfs_foundation"/>
-	<classpathentry combineaccessrules="false" kind="src" path="/xtreemfs_flease"/>
-	<classpathentry kind="output" path="build/classes"/>
-</classpath>
--- a/java/servers/eclipse-project/.classpath_WITH_BabuDB_project_reference
+++ b/java/servers/eclipse-project/.classpath_WITH_BabuDB_project_reference
@@ -6,12 +6,12 @@
 	<classpathentry kind="lib" path="../lib/commons-codec-1.3.jar"/>
 	<classpathentry kind="lib" path="../lib/test/commons-httpclient-3.0.1.jar"/>
 	<classpathentry kind="lib" path="../lib/test/commons-httpclient-3.0.1-contrib.jar"/>
 	<classpathentry kind="lib" path="../lib/test/commons-logging-1.1.jar"/>
-	<classpathentry kind="lib" path="../lib/test/junit-4.3.1.jar"/>
+	<classpathentry kind="lib" path="/usr/share/java/junit4.jar"/>
 	<classpathentry kind="lib" path="../lib/jdmkrt.jar"/>
 	<classpathentry kind="lib" path="../lib/jdmktk.jar"/>
-	<classpathentry kind="lib" path="../lib/protobuf-java-2.5.0.jar"/>
+	<classpathentry kind="lib" path="/usr/share/java/protobuf.jar"/>
 	<classpathentry kind="src" path="/xtreemfs_foundation"/>
 	<classpathentry combineaccessrules="false" kind="src" path="/BabuDB_trunk"/>
 	<classpathentry combineaccessrules="false" kind="src" path="/xtreemfs_flease"/>
 	<classpathentry kind="output" path="build/classes"/>
--- a/java/servers/nbproject/project.properties
+++ b/java/servers/nbproject/project.properties
@@ -26,12 +26,12 @@
 excludes=
 file.reference.BabuDB.jar-1=../lib/BabuDB.jar
 file.reference.bcprov-jdk16-139.jar=lib/bcprov-jdk16-139.jar
 file.reference.cdaclient.jar=lib/cdaclient.jar
-file.reference.junit-4.11.jar=../lib/test/junit-4.11.jar
+file.reference.junit-4.11.jar=/usr/share/java/junit4.jar
 file.reference.config.jar=lib/config.jar
 file.reference.je-3.2.13.jar=lib/je-3.2.13.jar
-file.reference.protobuf-java-2.5.0.jar=../lib/protobuf-java-2.5.0.jar
+file.reference.protobuf-java-2.5.0.jar=/usr/share/java/protobuf.jar
 file.reference.xbean.jar=lib/xbean.jar
 file.reference.jdmkrt.jar=../lib/jdmkrt.jar
 file.reference.jdmktk.jar=../lib/jdmktk.jar
 includes=**
--- a/bin/protoc-gen-pbrpc
+++ b/bin/protoc-gen-pbrpc
@@ -1,4 +1,4 @@
 #!/bin/bash
 FULLPATH=`readlink -f $0`
 BASEDIR=`dirname ${FULLPATH}`
-java -cp ${BASEDIR}/../java/pbrpcgen/dist/pbrpcgen.jar:${BASEDIR}/../java/lib/protobuf-java-2.5.0.jar org.xtreemfs.pbrpcgen.RPCSourceGenerator 
+java -cp ${BASEDIR}/../java/pbrpcgen/dist/pbrpcgen.jar:/usr/share/java/protobuf.jar org.xtreemfs.pbrpcgen.RPCSourceGenerator
--- a/bin/protoc-gen-pbrpccpp
+++ b/bin/protoc-gen-pbrpccpp
@@ -1,4 +1,4 @@
 #!/bin/bash
 FULLPATH=`readlink -f $0`
 BASEDIR=`dirname ${FULLPATH}`
-java -cp ${BASEDIR}/../java/pbrpcgen/dist/pbrpcgen.jar:${BASEDIR}/../java/lib/protobuf-java-2.5.0.jar org.xtreemfs.pbrpcgen.RPCCPPSourceGenerator 
+java -cp ${BASEDIR}/../java/pbrpcgen/dist/pbrpcgen.jar:/usr/share/java/protobuf.jar org.xtreemfs.pbrpcgen.RPCCPPSourceGenerator
--- a/java/pbrpcgen/nbproject/project.properties
+++ b/java/pbrpcgen/nbproject/project.properties
@@ -25,9 +25,9 @@
 dist.jar=${dist.dir}/pbrpcgen.jar
 dist.javadoc.dir=${dist.dir}/javadoc
 endorsed.classpath=
 excludes=
-file.reference.protobuf-java-2.5.0.jar=../lib/protobuf-java-2.5.0.jar
+file.reference.protobuf-java-2.5.0.jar=/usr/share/java/protobuf.jar
 includes=**
 jar.compress=false
 javac.classpath=\
     ${file.reference.protobuf-java-2.5.0.jar}
